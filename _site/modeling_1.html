<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Model your data with dbt</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="static/markdown.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">



<div class="topnav">
    <h1>Advanced Analytics for Web</h1>
</div>
<div class="lessonPage">
    <div class="lessonsNav">
        <a href="index.html">
            <h3>Overview</h3>
        </a>
        <h3>Track</h3>
        <a href="tracking_1.html"><span class="lessonsNumber">1</span>Install JS Tracker</a>
        <a href="tracking_2.html"><span class="lessonsNumber">2</span>Basic Events</a>
        <a href="tracking_3.html"><span class="lessonsNumber">3</span>Tracking Design</a>
        <a href="tracking_4.html"><span class="lessonsNumber">4</span>Custom Events</a>
        <a href="tracking_5.html"><span class="lessonsNumber">5</span>Testing</a>
        <h3>Enrich</h3>
        <a href="enrichment_1.html"><span class="lessonsNumber">1</span>Enrich your events</a>
        <h3>Model</h3>
        <a href="modeling_1.html"><span class="lessonsNumber">1</span>Model your data with dbt</a>
        <h3>Visualise</h3>
        <a href="tracking_1.html"><span class="lessonsNumber">1</span>Visualise 1</a>
        <a href="tracking_2.html"><span class="lessonsNumber">2</span>Visualise 2</a>
        <a href="tracking_2.html"><span class="lessonsNumber">3</span>Visualise 3</a>
    </div>
    <div class="lessonContent">

<div id="header">



<h1 class="title toc-ignore">Model your data with dbt</h1>

</div>


<p>In this section you will configure your dbt project and learn how to
run the snowplow-web package to model your web behavioural data.</p>
<div id="prerequisites" class="section level2">
<h2>Prerequisites</h2>
<ul>
<li>dbt must be installed</li>
<li>a new dbt project created and configured</li>
<li>a dataset of web events from the Snowplow Javascript tracker must be
available in your data warehouse (Snowflake will be used for
illustration but the package also supports BigQuery, Databricks,
Postgres and Redshift)</li>
</ul>
</div>
<div id="steps" class="section level2">
<h2>Steps:</h2>
<ol style="list-style-type: decimal">
<li>Install the snowplow-web dbt package</li>
<li>Change the default variables</li>
<li>Copy the selectors.yml into your project</li>
<li>Run the model</li>
<li>Check the output</li>
</ol>
</div>
<div id="breakdown-of-the-steps" class="section level2">
<h2>Breakdown of the steps</h2>
<div id="install-the-snowplow-web-package" class="section level3">
<h3>1. Install the snowplow-web package</h3>
<p>Find out which is the latest snowplow-web package from dbt’s official
website: <a href="https://hub.getdbt.com/snowplow/snowplow_web/latest/"
class="uri">https://hub.getdbt.com/snowplow/snowplow_web/latest/</a></p>
<p>1.1 Add the snowplow-web package to your packages.yml file:</p>
<pre class="yml"><code>packages:
  - package: snowplow/snowplow_web
    version: [&quot;&gt;=0.9.0&quot;, &quot;&lt;0.10.0&quot;]</code></pre>
<p>1.2 Run <code>dbt deps</code> to install the package. For more
information refer to dbt’s package hub.</p>
</div>
<div id="change-the-default-variables" class="section level3">
<h3>2. Change the default variables</h3>
<p>Theoretically, what you would need to do is go to
<code>your_dbt_project/dbt_packages/snowplow_web/dbt_project.yml</code>
file and check each default variable under the <code>vars</code> section
to see if you need to make any changes. Any time a change is required,
add that variable to your project’s dbt_project.yml file to overwrite
the default value due to precenence. For an in-depth guide for this
section please refer to the main <a
href="https://snowplow.github.io/dbt-snowplow-web/#!/overview/snowplow_web"><code>documentation site</code></a>.</p>
<p>However, for sake of simplicity we assume you followed the precious
tracking and enrichment steps and you have:</p>
<ul>
<li>data in the atomic.events table</li>
<li>enabled iab, ua and yauaa contexts / enrichments for your Snowplow
pipeline</li>
</ul>
<p>Let’s modify the most relevant variables at this stage (don’t worry
about the rest for now, you can fine-tune the model at a later stage
once you become a more advanced user, if necessary). Add the following
vars section to your dbt_project.yml file:</p>
<pre class="yml"><code>vars:
  snowplow_web:
    snowplow__start_date: &#39;2022-09-01&#39;
    snowplow__backfill_limit_days: 1
    snowplow__enable_iab: true
    snowplow__enable_ua: true
    snowplow__enable_yauaa: true</code></pre>
<p>Change the values to fit your needs. Here is a quick guide to
understand what they mean:</p>
<blockquote>
<p><code>snowplow__start_date</code>: The date of the first tracked
event inside your atomic.events table you would like to model. By
default ‘2020-01-01’ is set but you should overwrite it according your
dataset.</p>
</blockquote>
<blockquote>
<p><code>snowplow__backfill_limit_days</code>:Default 30. The maximum
numbers of days of new data to be processed since the latest event
processed. I would suggest to change this to 1 while you are working in
your dev environment so that you will be able to test how your
incremental runs work with your supposedly limited dataset once you have
a a couple of days worth of data in your atomic.events table.</p>
</blockquote>
<blockquote>
<p><code>snowplow__enable_iab</code>: Set this to true if have the iab
context enabled during enrichment</p>
</blockquote>
<blockquote>
<p><code>snowplow__enable_ua</code>: Set this to true if you have the ua
parser enabled during enrichment</p>
</blockquote>
<blockquote>
<p><code>snowplow__enable_yauaa</code>: Set this to true if you have the
yauaa context enabled during enrichment</p>
</blockquote>
</div>
<div id="copy-the-selectors.yml-into-your-project"
class="section level3">
<h3>3. Copy the selectors.yml into your project</h3>
<p>The web package provides a suite of suggested selectors, which will
help run and test the models. These are defined in the <a
href="https://github.com/snowplow/dbt-snowplow-web/blob/main/selectors.yml"><code>selectors.yml file</code></a>
within the package, however in order to use these model selections you
will need to copy this file into your own dbt project directory. This is
a top-level file and therefore should sit alongside your
<code>dbt_project.yml</code> file.</p>
</div>
<div id="run-the-model" class="section level3">
<h3>4. Run the model</h3>
<p>Execute the following either through your CLI or from within dbt
Cloud <code>dbt run --selector snowplow_web</code> This should take a
couple of minutes maximum.</p>
</div>
<div id="check-the-output" class="section level3">
<h3>5. Check the output</h3>
<p>Now head to the SQL editor of your choice (e.g.: Snowflake Web UI) to
check the model’s output. You should be able to see three new schemas
created:</p>
<ol style="list-style-type: decimal">
<li>your_custom_schema_name_<em>scratch</em>: drop and recompute models
that aid the incremental run</li>
<li>your_custom_schema_name_<em>derived</em>: main output models you can
use in your downstream models and reporting</li>
<li>your_custom_schema_name_<em>manifest</em>: tables that help the
integrity and core incremental logic of the model</li>
</ol>
<p>Check out the <code>database</code> section of the <a
href="https://snowplow.github.io/dbt-snowplow-web/#!/overview/snowplow_web"><code>documentation site</code></a>
for a breakdown of what the output should look like.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
